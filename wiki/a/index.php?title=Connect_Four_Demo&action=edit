<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>View source for Connect Four Demo - sdk-wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Connect_Four_Demo","wgTitle":"Connect Four Demo","wgCurRevisionId":3226,"wgRevisionId":0,"wgArticleId":313,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Connect_Four_Demo","wgRelevantArticleId":313,"wgRequestId":"374b6e4701bc9ec11b546cfb","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":["autoconfirmed"],"wgRestrictionMove":["autoconfirmed"]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","site":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready"});mw.loader.implement("user.tokens@0ppuq4y",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.cavendishmw-rethinkrobotics"]);});</script>
<link rel="stylesheet" href="/wiki/a/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor&amp;only=styles&amp;skin=cavendishmw-rethinkrobotics"/>
<script async="" src="/wiki/a/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=cavendishmw-rethinkrobotics"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="/wiki/a/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=cavendishmw-rethinkrobotics"/>
<meta name="generator" content="MediaWiki 1.31.0"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="/wiki/a/opensearch_desc.php" title="sdk-wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="http://sdk.rethinkrobotics.com/wiki/a/api.php?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="sdk-wiki Atom feed" href="/wiki/a/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/wiki/a/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=cavendishmw-rethinkrobotics&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Connect_Four_Demo rootpage-Connect_Four_Demo skin-cavendishmw-rethinkrobotics action-edit"><div id="container"><!-- start fragment header -->
    <!-- <div id="mozilla-org"><a href="#">Mozilla Skin</a></div> -->
    <div id="header" class="noprint">
        <a name="top" id="contentTop"></a>

        <!-- Logo + site name -->
        <h1>
            <a href="/wiki/Main_Page" style="text-indent: 2em; width: 194px; height: 67px; background: transparent url(/wiki/a/skins/cavendishmw-rethinkrobotics/styles/images/header_logo.png) no-repeat scroll 5px -5px;" title="Visit the main page">&nbsp;</a>        </h1>

	<div id="rr_ActionWrap">
	<!-- Account action links -->
	<div id="accountActions"><a href="/wiki/a/index.php?title=Special:UserLogin&returnto=Connect+Four+Demo&returntoquery=action%3Dedit">Log in</a></div>
        <!-- Search box -->
            <form action="/wiki/a/index.php" id="searchform">
        <label for="searchInput">Search</label>
        <input type='hidden' name="title" value="Special:Search"/>
        <input type="search" name="search" placeholder="Search sdk-wiki" title="Search sdk-wiki [f]" accesskey="f" id="searchInput"/>
        &#160;
        <input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"/>    </form>
	</div>
    </div> <!-- End header div -->
<!-- end fragment header --><div id="mBody"><!-- start fragment mainContent -->
<!-- start fragment firstHeader -->
<div id="firstHeadingDiv" class="firstHeading">
    <h1 lang="en"><span dir="auto">View source for Connect Four Demo</span></h1>


        <!-- Content action buttons -->
        <ul><li><a href="#">More</a><ul><li id="ca-viewsource" class="selected"><a href="/wiki/a/index.php?title=Connect_Four_Demo&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li><li id="ca-history"><a href="/wiki/a/index.php?title=Connect_Four_Demo&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li></ul></li><li id="ca-nstab-main" class="selected"><a href="/wiki/Connect_Four_Demo" title="View the content page [c]" accesskey="c">Page</a></li></ul>
</div><!-- end fragment firstHeader --><!-- start fragment sidebar -->        <div id="side" class="noprint" > <!-- cavendishmw: s/column-one/side/ -->
            <ul id="nav">
                      <li><span>Navigation</span>
            <ul>
                <li id="n-Getting-Started"><a href="/wiki/Getting_Started">Getting Started</a></li>
                <li id="n-Learning"><a href="/wiki/Learning">Learning</a></li>
                <li id="n-Community"><a href="/wiki/Community">Community</a></li>
                <li id="n-Support"><a href="/wiki/Support">Support</a></li>
            </ul>
        </li>
      <li><span>Links</span>
            <ul class="collapsible-collapsed">
                <li id="n-Forum"><a href="https://groups.google.com/a/rethinkrobotics.com/forum/#!forum/brr-users" rel="nofollow">Forum</a></li>
                <li id="n-Source"><a href="https://github.com/RethinkRobotics" rel="nofollow">Source</a></li>
                <li id="n-Source-API"><a href="http://api.rethinkrobotics.com/" rel="nofollow">Source API</a></li>
            </ul>
        </li>
      <li><span>Tools</span>
            <ul class="collapsible-collapsed">
                <li id="n-All-Pages"><a href="/wiki/Special:AllPages">All Pages</a></li>
                <li id="n-Upload-File"><a href="/wiki/Special:Upload">Upload File</a></li>
                <li id="n-What-Links-Here.3F"><a href="/wiki/Special:WhatLinksHere">What Links Here?</a></li>
            </ul>
        </li>
            </ul> <!-- /nav -->
        </div> <!-- /side -->
<!-- end fragment sidebar -->
<div id="mainContent"> <!-- cavendishmw: s/column-content/mainContent/ -->
    
  <div id="bodyContent" class="mw-body">
    <div id="siteSub">From sdk-wiki</div>
    <div id="contentSub">‚Üê <a href="/wiki/Connect_Four_Demo" title="Connect Four Demo">Connect Four Demo</a></div>
    <div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>
    
  <!-- start content -->
  <div id="mw-content-text"><p>You do not have permission to edit this page, for the following reasons:
</p>
<ul class="permissions-errors">
<li>The action you have requested is limited to users in one of the groups: <a href="/wiki/a/index.php?title=Sdk-wiki:Bureaucrats&amp;action=edit&amp;redlink=1" class="new" title="Sdk-wiki:Bureaucrats (page does not exist)">Bureaucrats</a>, administrator.</li>
<li>This page has been protected to prevent editing or other actions.</li>
</ul>
<hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" class="mw-editfont-monospace" lang="en" dir="ltr" name="wpTextbox1">[[File:connect_four_logo.png|link=http://www.hasbro.com/games/en_US/shop/details.cfm?R=80FB5BCA-5056-9047-F5F4-5EB5DF88DAF4:en_US&amp;catType=all%20games|Connect 4]]
== Summary ==
This demonstration allows Baxter to play Connect 4!

== Video ==
[[File:connect_four_youtube.png|link=https://www.youtube.com/watch?v=65HvMaUKnf4|Youtube Screenshot]]

== Installation/Prerequisites ==
'''Required:'''
* [[Installing-the-Research-SDK A Baxter Robot with a SDK software version >= 0.7.0]]
* A development PC setup with >= 0.7.0 software (development branch latest)
* A Connect 4 game board and pieces
* At least one Baxter Electric Gripper
* A game piece feeder ([[Connect Four Demo#creating-the-game-piece-feeder|instructions for building below]])

Check out the baxter_sandbox software (where Connect 4 demo is hosted) into your ROS workspace
&lt;source lang="bash">
    $ cd ~/ros_ws/src
    $ git clone https://github.com/RethinkRobotics/baxter_sandbox.git  
&lt;/source>
This demo requires the ability to specify the precision of joint position moves. This is availble in the development of the baxter_interface repository.
&lt;source lang="bash">
    $ cd ~/ros_ws/src/baxter_interface
    $ git checkout development
    $ git pull
&lt;/source>
Run &lt;code>catkin_make&lt;/code> to build the new additions in your ROS workspace
&lt;source lang="bash">
    $ cd ~/ros_ws/
    $ ./baxter.sh
    $ catkin_make
&lt;/source>

== Overview ==
Connect Four is a two player, turn based game, where each player tries to align four game pieces either horizontally, vertically or diagonally in the 7x6 game board. This demonstration was inspired by [http://www.informatik.uni-trier.de/~fernau/DSL0607/Masterthesis-Viergewinnt.pdfMasterthesis-Viergewinnt.pdf Victor Allis' Masters Thesis - A Knowledge-based Approach of Connect-Four] (although Baxter is currently not nearly this good!), during a one week hackathon.  

This demonstration exemplifies Baxter's SDK 0.7 software advances, including manipulation/accuracy improvements, as well as OpenCV usage for perception of the board state, and a minimax strategy implementation.

==Hardware Setup ==

=== Modifying Baxter's Fingertips ===
The shape (particularly the lips around the edges) of the Connect 4 game pieces required some modification of the gripper fingertips allowing Baxter to grasp the pieces solidly.

To do this, simply file down plastic fingertips allowing the parallel gripper to close solidly on the center of the piece.
[[File:connect_four_gripper_1.png|Gripper Filed 1]]
[[File:connect_four_gripper_2.png|Gripper Filed 2]]

During modification, test that the gripper has a solid grasp on the piece using the gripper_cuff_control example:
&lt;source lang="bash">
    $ rosrun baxter_examples gripper_cuff_control.py
&lt;/source>
=== Creating the game piece feeder ===
It will be necessary to create a feeder which will provide Baxter with pieces for grasping in a static location.

80x20 was used to create a feeder which will backfill the  pieces some static location -  

[[File:connect_four_feeder_1.png|Piece Feeder 1]]
[[File:connect_four_feeder_2.png|Piece Feeder 2]]
[[File:connect_four_feeder_4.png|Piece Feeder 4]]

The end of the extruded portion was bent, to stop the pieces from further rolling. Adding the rubber finger tip over this allowed for a gentle stop.

[[File:connect_four_feeder_5.png|Piece Feeder 5]]
[[File:connect_four_feeder_6.png|Piece Feeder 6]]

=== Board and Feeder Placement ===
Choosing an appropriate location for the game board and feeder is important due to Baxter's manipulation space.

Place the game board and feeder in a location where Baxter will be able to manipulate pieces into each of the board slots (Adding 10cm for approach/retreats in the Z-axis), and pick game pieces appropriately. Grasping the limb and entering it into zero-g mode should allow you to verify these locations.

It is advised to use double sided tape to prevent the game board/feeder from moving during play.  

[[File:connect_four_board_1.png|Game Board Tape]]
[[File:connect_four_feeder_3.png|Piece Feeder Tape]]

== Tutorial ==
=== Running the Demo ===
Verify that the robot is enabled from an [[RSDK Shell|RSDK terminal session]], ex:
&lt;source lang="bash">
    $ rosrun baxter_tools enable_robot.py -e
&lt;/source>

==== Starting/Configuring the Perception ====
Start the vision from an [[RSDK Shell|RSDK terminal session]], making sure to define which hand camera we will use, ex:
&lt;source lang="bash">
    $ rosrun connect_four connect_vision.py -l right
&lt;/source>

Resulting in the connect four vision gui being launched

[[File:connect_four_vision_1.png|Vision 1]]

Grasp the cuff, placing Baxter's hand camera in a location where he will be able to see all placements locations on the board (such as above). Be sure that the fingers or a grasped game piece will not occlude the board.

Click and drag all four corners corners of the ROI (Region Of Interest) selector (green quadrilateral) to locations at the edge of the game board.

[[File:connect_four_vision_2.png|Vision 2]]
[[File:connect_four_vision_3.png|Vision 3]]

Resulting in  

[[File:connect_four_vision_4.png|Vision 4]]

The 'Yellow' subwindow describes the perceived yellow game pieces. This is done in HSV space, identifying yellow pixels based on a chosen hue range.

[[File:connect_four_vision_yellow.png|Vision yellow]]

Likewise, the 'Red' subwindow describes observed red game pieces.

[[File:connect_four_vision_red.png|Vision red]]

Because we have a known grid size, 7x6, and a user selected ROI describing the whole of the game board, the perception is done by counting the observed yellow/red pixels in each grid location. We then threshold (configurable with the slider on the main window) on the total count of pixels per grid location.

The result is overlaid on the following image. The numbers 1 and 2 denote that Baxter has seen the placed pieces.

[[File:connect_four_vision_board_state.png|Vision Board]]

This exact structure 7x6 matrix, is published on the topic ``&lt;code>/vision/connect_four_state&lt;/code>`` as a string, where 0's denote unoccupied, 1 denoting red, 2 denoting yellow.

'''Important Note:'''  You may need to adjust the gain for the camera based on the lighting. This has been provided through a slider at the top of the main window. Adjust this to a level where the yellow and red subwindows look to be observing the game pieces regularly.

'''Important Note:''' You will need to adjust the ROI so that in the 'Board State' window's grid is filled accurately with the actual game board locations. Making sure that the locations do not cross into multiple grid locations as this will cause false positives.

==== Running a New Game ====
After starting the vision as shown above, from another [[RSDK Shell|RSDK terminal session]], start a new Connect Four game, defining which limb you will be using, as well as the color of Baxter's game pieces, ex:
&lt;source lang="bash">
    = We will use the right arm, where Baxter is playing with the red pieces =
    $ rosrun connect_four connect_game.py -l right -c red
&lt;/source>

There are four limb configurations the player will need to specify, the camera location (where the game board can be observed through the hand camera), the game piece pick location (from the feeder), the left most board location (from Baxter's perspective), and the right most board location.

These locations will be saved to a file for convenience for future games.

You will be prompted to use these previously specified locations:

&lt;source lang="bash">
    Would you like to use the previously found pick and place locations (y/n)?
&lt;/source>

Specifying 'y' will jump you to the start of the game.

Specifying 'n' will allow you to record the required locations for your setup.

&lt;source lang="bash">
    Move right arm into a location allowing the camera to see the board - press Circle button to confirm
&lt;/source>

The circle button here, refers to the circle button on the cuff on the chosen limb.

Likewise, you will specify the game piece pick location with the circle button. The gripper will grasp your game piece.

You will then be prompted to:

&lt;source lang="bash">
Move Gripper into left most drop slot - press Dash button to record
&lt;/source>
Move the limb so that the held game piece is just inside the left most (from Baxter's perspective) drop slot, where if released would result in a successful placement. Press the dash button.

Do the same for the right most drop slot.

The manipulation portion will then be able to create/segment a vector across the top of the game board identifying the other place locations. It will also use the IK solver service to find an appropriate approach for the piece pick location, and each of the place locations 5cm above in the z-axis.

The hand camera will then go back to the camera observation location, prompting you to validate the ROI. This simply allows you to make any final adjustments so that the 'Board State' window is appropriately populated.

You will then enter your name and a difficulty level (1-4). This difficulty level describes the depth of recursion in which Baxter will explore the search tree in the minimax implementation. 1 being the easiest, 4 being the hardest. Please feel free to make this demo better by submitting pulls with improvements in Baxter's gameplay!!

Lastly, you will choose who will go first.

That's it! Game on!

If you come across any issues please see the below troubleshooting section, or post to the forum!

== Interfaces ==
=== ROS APIs ===
''See the [[API Reference|API Reference]] page for details.''  
* Joint Position Commands - /robot/limb/\&lt;left/right\>/joint_command  
[baxter_core_msgs/JointCommand]
* Baxter Hand Cameras - /cameras/\&lt;left/right\>\_hand_camera/image  
[sensor_msgs/Image]
* IK Solver Service: &lt;code>/ExternalTools/&lt;limb>/PositionKinematicsNode/IKService&lt;/code>

=== baxter_interface APIs ===
* Limb class: &lt;code>limb.py&lt;/code>

== Related Examples/Tutorials ==
* [[Joint Position Example|Joint Position File Playback Example]]
* [[IK Service Example|Inverse Kinematics Example]]

== Troubleshooting ==
=== The arm is moving oddly/colliding with the board/table   ===
It is possible that the IK solutions found may have resulted in an 'elbow down' configuration causing the motion between positions to be large causing the collision.

Restart the demo recording new joint configurations. Make sure that the arm is capable of reaching 5cm above the board across all positions while holding the limb in zero-g mode.

=== Baxter is not seeing the user moves or seeing moves that didn't happen.   ===
The vision portion of the program is not configured correctly.

Please verify that the ROI (dragging the blue circles overlaid on the image to the corners of the game board) of the board slots line up with the projected image grid ('Board State' subwindow), and that the gain is set (sliding the gain slider) so that the pieces are identified in the red and yellow subwindows accurately (lighting dependent).
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="/wiki/Connect_Four_Demo" title="Connect Four Demo">Connect Four Demo</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://sdk.rethinkrobotics.com/wiki/Connect_Four_Demo">http://sdk.rethinkrobotics.com/wiki/Connect_Four_Demo</a>"</div>
  <div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>  <!-- end content -->
  
    <div class="visualClear"></div>
</div>
</div> <!-- /mainContent -->
<!-- end fragment mainContent --></div> <!-- /mBody --><div class="visualClear"></div><!-- start fragment footer -->    <div id="footer" role="contentinfo">
        <div id="f-poweredbyico">
                <a href="//www.mediawiki.org/"><img src="/wiki/a/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/a/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/a/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>
            </div>
        <ul id="f-list">
                <li id="copywrite_notice">&copy; 2015 Rethink Robotics. All rights reserved.</li>
                <li id="special_pages"><a href="/wiki/Special:SpecialPages" title="Special:SpecialPages">SpecialPages</a></li>
                <li id="privacy"><a href="/wiki/Sdk-wiki:Privacy_policy" title="Sdk-wiki:Privacy policy">Privacy policy</a></li>
                <li id="about"><a href="/wiki/Sdk-wiki:About" title="Sdk-wiki:About">About sdk-wiki</a></li>
                <li id="disclaimer"><a href="/wiki/Sdk-wiki:General_disclaimer" title="Sdk-wiki:General disclaimer">Disclaimers</a></li>
            </ul>
    </div><!-- end fragment footer --></div><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":55});});</script></body></html>